
```sql
-- 1) New runs table
CREATE TABLE processing_runs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name TEXT NOT NULL,
  type_id UUID NOT NULL REFERENCES types(id) ON DELETE RESTRICT,
  limit_count INT NOT NULL DEFAULT 5 CHECK (limit_count > 0 AND limit_count <= 50),
  status TEXT NOT NULL DEFAULT 'created' CHECK (status IN ('created', 'running', 'failed', 'completed')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ
);

CREATE INDEX idx_processing_runs_status_created ON processing_runs(status, created_at);


-- 2) Link entries to a run + add safer status state
ALTER TABLE entries
  ADD COLUMN run_id UUID REFERENCES processing_runs(id) ON DELETE SET NULL;

ALTER TABLE entries
  DROP CONSTRAINT IF EXISTS entries_status_check;

ALTER TABLE entries
  ADD CONSTRAINT entries_status_check
  CHECK (status IN ('pending', 'processing', 'processed', 'archived'));

CREATE INDEX idx_entries_run_status ON entries(run_id, status);


-- Optional MVP+ column (can be null for old rows)
ALTER TABLE entries
  ADD COLUMN why_it_matters TEXT;


-- 3) Link reports to a run + (optional) store sources later
ALTER TABLE reports
  ADD COLUMN run_id UUID REFERENCES processing_runs(id) ON DELETE SET NULL;

-- Optional: store sources/metadata without schema pain
ALTER TABLE reports
  ADD COLUMN sources JSONB;
```